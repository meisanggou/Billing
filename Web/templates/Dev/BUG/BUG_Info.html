<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>BUG信息</title>
<link rel="stylesheet" href="{{ url_for('static', filename='t_css/bootstrap.min.css') }}"><!-- 新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="{{ url_for('static', filename='t_css/main.css') }}"><!--自定义的页面样式 -->
</head>

<body>
<div class="container font16">
<div class="bugInfoShow">
    <p>BUG系统编号：{{ bug_info["basic_info"]["bug_no"] }}</p>
    <p><span class="font-red">BUG标题：</span>{{ bug_info["basic_info"]["bug_title"] }}</p>
    <p>BUG提交时间：{{ bug_info["basic_info"]["submit_time"] }}</p>
    <p>BUG提交者：{{ bug_info["basic_info"]["submitter"] }}</p>
    <p><span class="font-red">BUG状态：</span>{{ bug_status_desc[bug_info["basic_info"]["bug_status"]] }}</p>
    <p>
        {#如果当前状态为 已有BUG疑似拥有者 显示疑似拥有者#}
        {% if bug_info["basic_info"]["bug_status"] == 1 %}
            <span class="font-red">BUG疑似拥有者：</span>
            {% for user_name in bug_info["link_user"]["ys"].keys() %}
                {{ user_name }}
            {% endfor %}
        {#如果当前状态为 已有BUG拥有者 显示拥有者#}
        {% elif bug_info["basic_info"]["bug_status"] == 2 %}
            BUG拥有者：
            {% for user_name in bug_info["link_user"]["owner"].keys() %}
                {{ user_name }}
            {% endfor %}
        {#如果当前状态为 BUG已修复 显示信息#}
       {% elif bug_info["basic_info"]["bug_status"] == 3 %}
            BUG已被修复
        {% endif %}
    </p>
</div>
<div class="bugInfoDepict">
{#BUG的描述信息#}
{% for item in bug_info["example_info"] %}
    {% if item["example_type"] == 1 %}
        <p>{{ item["content"] }}</p>
    {% else %}
        <img src="/{{ item['content']}}" width="100%">
    {% endif %}
{% endfor %}
</div>
{# 提交关于BUG的描述 只有BUG提交者才可以提交 并且要在BUG的状态小于3即BUG处于未修复状态下才可以 #}
<div class="clear bottom20 bugUpload">
{% if bug_info["basic_info"]["submitter"] == current_user and bug_info["basic_info"]["bug_status"] < 3 %}
    <form class="bugTextMode" action="/dev/bug/{{ bug_no }}/str/example/", method="post">
        <span class="pull-left">请添加bug的相关文字描述：</span>
        <textarea class="form-control bottom10" rows="5" name="bug_str_example"></textarea>
        <button class="btn btn-primary" type="submit">提交</button>
    </form>
    <form action="/dev/bug/{{ bug_no }}/img/example/" method="post" enctype="multipart/form-data">
        <span class="pull-left">请添加bug的相关图片描述：</span>
        <input class="btn btn-default pull-left bugUploadBtn" type="button" value="请选择文件" name="file">
        <input class="pull-left" type="file" accept="image/jpeg, image/png, image/gif" name="bug_img_example">
        <button class="btn btn-primary" type="submit" value="上传">上传</button>
    </form>
{% endif %}
{#添加疑似BUG拥有者#}
{% if bug_info["basic_info"]["bug_status"] < 2 %}
    <form action="/dev/bug/{{ bug_no }}/ys/", method="post">
        <span class="pull-left">添加疑似BUG拥有者：</span>
        <select class="form-control pull-left bug-input" name="ys_user">
            {% for user in user_list %}
                {% if not user["user_name"] in bug_info["link_user"]["ys"] %}
                <option value="{{ user["user_name"] }}">{{ user["nick_name"] }}</option>
                {% endif %}
            {% endfor %}
        </select>
        <button class="btn btn-primary" type="submit">添加</button>
    </form>
{% endif %}

{#添加BUG拥有者#}
{% if bug_info["basic_info"]["bug_status"] < 3 %}
    {% if bug_info["basic_info"]["submitter"] == current_user %}
    <form action="/dev/bug/{{ bug_no }}/owner/", method="post">
        <span class="pull-left">添加BUG拥有者：</span>
        <select class="form-control pull-left bug-input" name="owner">
            {% for user in user_list %}
                {% if not user["user_name"] in bug_info["link_user"]["owner"] %}
                <option value="{{ user["user_name"] }}">{{ user["nick_name"] }}</option>
                {% endif %}
            {% endfor %}
        </select>
        <button class="btn btn-primary" type="submit">添加</button>
    </form>
    {% endif %}
    {% if current_user not in bug_info["link_user"]["owner"] %}
    <form action="/dev/bug/{{ bug_no }}/owner/", method="post">
        <input name="owner" value="{{ current_user }}" style="display: none"/>
        <button class="btn btn-primary" type="submit">标记为我的BUG</button>
    </form>
    {% endif %}
{% endif %}

{#完成BUG#}
{% if bug_info["basic_info"]["bug_status"] < 3 %}
    {% if bug_info["basic_info"]["submitter"] == current_user %}
    <form action="/dev/bug/{{ bug_no }}/fix/", method="post">
        <button class="btn btn-primary" type="submit">BUG已修复</button>
    </form>
    {% endif %}
{% endif %}

{#取消BUG#}
{% if bug_info["basic_info"]["bug_status"] < 3 %}
    {% if bug_info["basic_info"]["submitter"] == current_user %}
    <form action="/dev/bug/{{ bug_no }}/cancel/", method="post">
        <button class="btn btn-primary" type="submit">取消BUG</button>
    </form>
    {% endif %}
{% endif %}

{#不过属于BUG 设计如此#}
{% if bug_info["basic_info"]["bug_status"] < 3 %}
    {% if user_role | bit_and(role_value["bug_cancel"]) == role_value["bug_cancel"] %}
    <form action="/dev/bug/{{ bug_no }}/design/", method="post">
        <button class="btn btn-primary" type="submit">不是BUG，就是这么设计的</button>
    </form>
    {% endif %}
{% endif %}

</div>
</div>
</body>
</html>