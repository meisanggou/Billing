{% extends "base.html" %}

{% block title %}查看API解释{% endblock %}

{% block content %}
    <br>
    <a class="btn btn-primary pull-right" href="{{ return_url }}" title="">API列表</a>
    {% if update_url %}
    <a class="btn btn-primary pull-right margin10" href="{{ update_url }}" title="">修改</a>
    {% endif %}
    {% if test_url %}
    <a class="btn btn-primary pull-right margin10" href="{{ test_url }}" title="">测试API</a>
    {% endif %}
    {% if batch_test_url %}
    <a class="btn btn-primary pull-right margin10" href="{{ batch_test_url }}" title="">批量测试</a>
    {% endif %}
    <div class="clear"></div>
    <input class="form-control bottom10" id="api_no" value="{{ api_no }}" style="display:none;"/>
    <p>API标题: {{ api_info["basic_info"]["api_title"] }}</p>
    <p>API URL: {{ api_info["basic_info"]["api_url"] }}</p>
    <p>API 请求方式: {{ api_info["basic_info"]["api_method"] }}</p>
    <p>API 描述: {{ api_info["basic_info"]["api_desc"] }}</p>
    <p>API 状态: {{ api_info["basic_info"]["status"] }}</p>
    <p>添加时间: {{ api_info["basic_info"]["add_time"] }}</p>
    <p>最近更新时间: {{ api_info["basic_info"]["update_time"] }}</p>
{% if api_info["header_info"] | length > 0 or api_info["predefine_param"]["header"] | length > 0 %}
<table class="table table-bordered api-list-table" id="api_header_param">
    <caption>请求头部参数</caption>
    <tr>
        <th scope="col" width="15%">参数名称</th>
        <th class="text-center" scope="col" width="8%">是否必须</th>
        <th scope="col" width="77%">参数描述</th>
    </tr>
    {#    加载预定义头部参数描述#}
    {% for item in api_info["predefine_param"]["header"] %}
        {% if item in api_info["predefine_header"] %}
        <tr>
            <td>{{ api_info["predefine_header"][item]["param"] }}</td>
            <td class="text-center">
                {% if api_info["predefine_header"][item]["necessary"] %}
                    是
                {% else %}
                    否
                {% endif %}
            </td>
            <td>{{ api_info["predefine_header"][item]["param_desc"] }}</td>
        </tr>
        {% endif %}
    {% endfor %}
    {% for item in api_info["header_info"] %}
    <tr>
        <td>{{ item["param"] }}</td>
        <td class="text-center">
            {% if item["necessary"] %}
                是
            {% else %}
                否
            {% endif %}
        </td>
        <td>{{ item["param_desc"] }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}
{% if api_info["body_info"] | length > 0 or api_info["predefine_param"]["body"] | length > 0 %}
<table class="table table-bordered api-list-table" id="api_body_param">
    <caption>请求主体参数</caption>
    <tr>
        <th scope="col" width="15%">参数名称</th>
        <th class="text-center" scope="col" width="8%">是否必须</th>
        <th class="text-center" scope="col" width="10%">参数类型</th>
        <th scope="col" width="67%">参数描述</th>
    </tr>
    {#    加载预定义头部参数描述#}
    {% for item in api_info["predefine_param"]["body"] %}
        {% if item in api_info["predefine_body"] %}
        <tr>
            <td>{{ api_info["predefine_body"][item]["param"] }}</td>
            <td class="text-center">
                {% if api_info["predefine_body"][item]["necessary"] %}
                    是
                {% else %}
                    否
                {% endif %}
            </td>
            <td class="text-center">{{ api_info["predefine_body"][item]["type"] }}</td>
            <td>{{ api_info["predefine_body"][item]["param_desc"] }}</td>
        </tr>
        {% endif %}
    {% endfor %}
    {% for item in api_info["body_info"] %}
    <tr>
        <td>{{ item["param"] }}</td>
        <td class="text-center">
            {% if item["necessary"] %}
                是
            {% else %}
                否
            {% endif %}
        </td>
        <td class="text-center">{{ item["type"] }}</td>
        <td>{{ item["param_desc"] }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}
{% if api_info["input_info"] | length > 0 %}
<div class="bottom20 api-example">
    <b>请求示例</b>
    <div id="api_input_exist">
        {% for item in api_info["input_info"] %}
        <div>
           <p>{{ item["input_desc"] }}</p>
           <p><textarea class="form-control" readonly>{{ item["input_example"] }}</textarea></p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% if api_info["output_info"] | length > 0 %}
<div class="bottom20 api-example">
    <b>返回示例</b>
    <div id="api_output_exist">
        {% for item in api_info["output_info"] %}
           <p>{{ item["output_desc"] }}</p>
           <p><textarea class="form-control" readonly>{{ item["output_example"] }}</textarea></p>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="care">
    <input id="care_url" value='{{ url_prefix }}/care/' style="display: none"/>
    {% if my_care %}
       <button class="btn btn-primary pull-right" onclick="change_care();" id="make_care">取消关注</button>
    {% else %}
        <button class="btn btn-primary pull-right" onclick="change_care();" id="make_care">关注</button>
    {% endif %}
    <p><b>已关注的人(如果您使用到该API，请关注，以便API一旦发生更改，能尽快通知您。)</b></p>
    <div id="api_care_user">
        {% if my_care %}
            <span id="mine_care">我</span>
        {% endif %}
        {% for item in api_info["care_info"] %}
        <span>{{ item["nick_name"] }}</span>
        {% endfor %}
    </div>
</div>
{% if my_care and my_care["level"] == 0 %}
<form action="{{ url_prefix }}/delete/{{ api_no }}/" method="get">
    <button class="btn btn-primary pull-right" >删除API</button>
</form>
{% endif %}
<br>
<a  href="{{ status_url }}?api_no={{ api_no }}" title="">查看返回状态码解释</a>
{{ 't_js/API_HELP/show_api.js' | make_script_html | safe }}
{% endblock %}